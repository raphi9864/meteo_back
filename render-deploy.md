# Guide de déploiement Render + Oracle Cloud

## 1. Préparer Oracle Cloud Database

### Création de la base de données
1. Aller sur [cloud.oracle.com](https://cloud.oracle.com)
2. Créer un compte gratuit Oracle Cloud
3. Dans le menu, aller à "Autonomous Database"
4. Cliquer "Create Autonomous Database"
5. Choisir "Always Free" 
6. Configurer :
   - Database name: `todoapi`
   - Display name: `TodoApi Database`
   - Admin password: `VotreMotDePasseSecurise123!`

### Configuration réseau
1. Dans votre Autonomous Database, aller à "Network"
2. Modifier "Access Control List"
3. Ajouter `0.0.0.0/0` pour autoriser tous les IPs (temporaire)
4. ⚠️ **Important**: Restreindre les IPs après déploiement

### Récupérer la chaîne de connexion
1. Dans votre base, cliquer "Database connection"
2. Télécharger le "Wallet"
3. Copier la chaîne de connexion (format TNS)

## 2. Configurer l'application pour Render

### Variables d'environnement Render
Configurer ces variables dans Render :

```
ConnectionStrings__DefaultConnection=Data Source=(description=(retry_count=20)(retry_delay=3)(address=(protocol=tcps)(port=1522)(host=VOTRE_HOST.oraclecloud.com))(connect_data=(service_name=VOTRE_SERVICE_high.adb.oraclecloud.com))(security=(ssl_server_dn_match=true)));User Id=ADMIN;Password=VotreMotDePasseSecurise123!;

Jwt__Key=VotreCleSecreteTresTresLongueEtSecuriseePouraProduction123456789
```

### Commandes de build Render
- Build Command: `dotnet publish -c Release -o out`
- Start Command: `dotnet out/TodoApi.dll`

## 3. Créer les tables Oracle Cloud

Se connecter à Oracle Cloud SQL Developer Web et exécuter :

```sql
-- Créer les tables
CREATE TABLE USERS (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    EMAIL VARCHAR2(255) NOT NULL UNIQUE,
    PASSWORDHASH VARCHAR2(500) NOT NULL,
    FIRSTNAME VARCHAR2(100),
    LASTNAME VARCHAR2(100),
    CREATEDAT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ISACTIVE NUMBER(1) DEFAULT 1
);

CREATE TABLE TODOITEMS (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TITLE VARCHAR2(500) NOT NULL,
    ISDONE NUMBER(1) DEFAULT 0,
    USERID NUMBER NOT NULL,
    CONSTRAINT FK_TODOITEMS_USERS FOREIGN KEY (USERID) REFERENCES USERS(ID)
);

CREATE TABLE USERPROFILES (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FIRSTNAME VARCHAR2(100),
    LASTNAME VARCHAR2(100),
    EMAIL VARCHAR2(255) UNIQUE,
    BIRTHDATE DATE
);
```

## 4. Déployer sur Render

1. Connecter votre repo GitHub à Render
2. Choisir "Web Service"
3. Configurer :
   - Runtime: `.NET`
   - Build Command: `dotnet publish -c Release -o out`
   - Start Command: `dotnet out/TodoApi.dll`
4. Ajouter les variables d'environnement
5. Déployer !

## 5. Sécuriser après déploiement

### Restreindre l'accès Oracle
1. Récupérer l'IP de votre service Render
2. Dans Oracle Cloud, modifier l'Access Control List
3. Remplacer `0.0.0.0/0` par l'IP spécifique de Render

### Variables sensibles
- Utiliser des mots de passe forts
- Changer la clé JWT de production
- Activer HTTPS uniquement 